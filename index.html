<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RisuAI 통합 에셋 추출기</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="module" src="https://esm.sh/png-chunks-extract"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>RisuAI 통합 에셋 추출기</h1>
        <p>캐릭터 카드(.png, .charx) 또는 모듈(.risum) 파일에서 에셋을 추출합니다.</p>
        
        <div class="tab-container">
            <button class="tab-button active" onclick="openTab(event, 'cardExtractor')">캐릭터 카드 추출기</button>
            <button class="tab-button" onclick="openTab(event, 'moduleExtractor')">모듈(.risum) 추출기</button>
        </div>

        <!-- 캐릭터 카드 추출기 탭 -->
        <div id="cardExtractor" class="tab-content" style="display: block;">
            <h2>캐릭터 카드 에셋 추출</h2>
            <p>.png 또는 .charx 파일을 아래 영역에 드래그 앤 드롭하거나 클릭하여 선택하세요. jpg, jpeg도 지원. json은 지원X.</p>
            <div class="drop-zone" id="cardDropZone">
                <input type="file" id="cardFileInput" accept=".png,.charx,.jpg,.jpeg" style="display: none;">
                <p>파일을 여기에 드롭하세요</p>
            </div>
            <div id="cardStatus" class="status"></div>
            
            <div id="cardStructureContainer" style="display: none;">
                <div class="structure-header">
                    <h3>파일 구조 정보 (메타데이터)</h3>
                </div>
                <pre id="cardStructureView"></pre> 
            </div>

            <!-- [수정됨] 다운로드 버튼 그룹 -->
            <div id="cardDownloadButtons" class="button-group" style="display: none;">
                <div>
                    <button id="cardDownloadAssetsByNameBtn" class="download-button">에셋 다운로드(파일명만으로 네이밍)</button>
                    <p class="button-description">메타데이터의 이름만으로 에셋을 저장합니다. <strong>파일 이름이 중복되어 덮어쓰여지는 문제를 해결하기 위해,</strong> 중복된 이름의 에셋이 존재할 시에 파일명 뒤에 메타데이터에서 확인되는 번호를 붙입니다 (예: `이름_123.png`).</p>
                </div>
                <div>
                    <button id="cardDownloadAssetsNumberedBtn" class="download-button">에셋 다운로드 (번호_파일명으로 네이밍)</button>
                    <p class="button-description">모든 에셋 파일명 앞에 메타데이터상의 번호를 붙여 (예: `123_이름.png`) 저장합니다.</p>
                </div>
                <div>
                    <button id="cardDownloadStructureBtn" class="download-button btn-secondary">메타데이터(JSON) 다운로드</button>
                     <p class="button-description">카드에 포함된 모든 설정과 에셋 정보를 담고 있는 원본 `card.json` 데이터를 다운로드합니다.</p>
                </div>
            </div>
            <div id="cardResults" class="results"></div>
        </div>

        <!-- 모듈 추출기 탭 (변경 없음) -->
        <div id="moduleExtractor" class="tab-content">
            <h2>모듈(.risum) 에셋 추출</h2>
            <p>.risum 파일을 아래 영역에 드래그 앤 드롭하거나 클릭하여 선택하세요.</p>
             <div class="drop-zone" id="moduleDropZone">
                <input type="file" id="moduleFileInput" accept=".risum" style="display: none;">
                 <p>파일을 여기에 드롭하세요</p>
            </div>
            <div id="moduleStatus" class="status"></div>
            <div id="moduleStructureContainer" style="display: none;">
                <div class="structure-header">
                    <h3>파일 구조 정보</h3>
                    <button id="moduleDownloadStructureBtn" class="btn-secondary">JSON 다운로드</button>
                </div>
                <pre id="moduleStructureView"></pre>
            </div>
            <button id="moduleDownloadAllBtn" class="download-button" style="display: none;">모든 에셋을 ZIP으로 다운로드</button>
            <div id="moduleResults" class="results"></div>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
    <script type="module" src="./card-extractor.js"></script>
    <script type="module" src="./module-extractor.js"></script>
</body>
</html>